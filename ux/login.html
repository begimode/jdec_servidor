<!DOCTYPE html>
<html lang="en">
<html>

<head>
    <meta charset="utf-8" />
    <title> Editar Perfil </title>

    <!-- ---------------------------------------------------- -->
    <!-- Insertar Scripts-->
    <script src="logicaFake/insertarUsuario.js"></script>
    <script src="logicaFake/buscarUsuario.js"></script>
    <script src="logicaFake/desencriptar.js"></script>
    <script src="logicaFake/verify.js"></script>
    <script src="logicaFake/auth.js"></script>
    <script src="logicaFake/generateToken.js"></script>

    <!-- Registrar -->
    <script>
        function registrar() {
            var correo = document.getElementById("correo").value
            var contrasenya = document.getElementById("contrasenya").value
            var telefono = document.getElementById("telefono").value
            var nombre = document.getElementById("nombre").value
            var apellidos = document.getElementById("apellidos").value

            var datos = { correo: correo, contrasenya: contrasenya, telefono: parseInt(telefono), nombre: nombre, apellidos: apellidos, estado: "No Verificado" }

            insertarUsuario(datos, function (err, res) {
                // cuando tenga el resultado lo muestr
                if (err) {
                    alert(" hubo un error de transmisi칩n http: " + err)
                    return
                }
            })
        }
    </script>

    <!-- Login -->
    <script>
        function login() {
            var correo = document.getElementById("correo").value
            var contrasenya = document.getElementById("contrasenya").value


            buscarUsuario(correo, function (err, res) {
                // cuando tenga el resultado lo muestro
                if (err) {
                    alert(" hubo un error de transmisi칩n http: " + err)
                    return
                } else if (res.error) {
                    alert(" hubo un error en la llamada: " + JSON.stringify(res.error))
                    return
                }

                var datosCont = { hash: res.contrasenya, cont: contrasenya }
                console.log(datosCont);
                /*
                        desencriptar(datosCont, function (err, res) {
                          console.log(res);
                            if(res == true){
                              window.location.href = "index.html"
                            }
                            else{
                              console.log("Incorrecto");
                            }
                        })
                
                        */
                desencriptar(datosCont, function (err, res) {
                    console.log(res);
                    if (res == true) {
                        generateToken(correo, function (err, res) {
                            window.location.href = "Aplicacion.html"
                        })

                    }
                    else {
                        console.log("Incorrecto");
                    }
                })




                /*
                if (res.correo == correo && res.contrasenya == correo) {
                  auth("pepe", function (err, res) {
                    // cuando tenga el resultado lo muestro
                    if (err) {
                      alert(" hubo un error de transmisi칩n http: " + err)
                      return
                    }
                    console.log(res)
                  })
                  //window.location.href = "index.html";
                  
          
          
          
                }
          */
            })


        }
    </script>

</head>

<body>

    <h3>J.DEC</h3>
    <h1>Login y Registrar</h1>


    <form>
        Correo:<br>
        <input id="correo" type="text" name="id" value="">
        <br>
    </form>

    <form>
        Contrase침a:<br>
        <input id="contrasenya" type="text" name="id" value="">
        <br>
    </form>

    <form>
        Telefono:<br>
        <input id="telefono" type="number" name="id" value="">
        <br>
    </form>

    <form>
        Nombre:<br>
        <input id="nombre" type="text" name="id" value="">
        <br>
    </form>

    <form>
        Apellidos:<br>
        <input id="apellidos" type="text" name="id" value="">
        <br>
    </form>

    <p>

        <button type="buton" onclick="login()">Login</button>

    </p>

    <p>

        <button type="buton" onclick="registrar()">Registrar</button>

    </p>

</body>

</html>